# BOM_自采配件清单处理工具集
本文件夹包含5个Python脚本，用于小型电子工作室小批量生产场景下：BOM物料清单处理、自采/非自采器件区分、ModAcc配件清单生成与搜索，解决手动整理低效、易出错的问题。

## 一、包含工具及核心功能
| 脚本文件名                          | 核心功能                                                                 |
|-------------------------------------|--------------------------------------------------------------------------|
| `bom_component_search.py`             | 搜索BOM文件中包含指定元器件关键词的文件（如找“RES-ADJ-TH_3362P”所在BOM） |
| `extract_bom_components.py`    | 提取BOM中**自采器件**，生成「按模块汇总表」+「去重类型表」               |
| `mod_acc_list_gen.py`          | 生成ModAcc模块/扩展板的标准化配件清单模板（含自动算总价公式）             |
| `modacc_accessory_processor.py`     | 处理ModAcc配件清单，生成「模块汇总表」+「去重配件类型表」                |
| `process_non_self_purchase_components.py`| 提取BOM中**非自采器件**（如合作厂商采购），生成「常规/特殊器件分类表」   |


## 二、关键前置规则（必须遵守，否则脚本无法识别）
### 1. 自采器件标注格式（脚本识别核心）
脚本通过以下3列的**非空内容**判定“自采器件”（3列中任意1列有内容即视为自采），需在原始BOM/配件清单中按此标注：
| 列名          | 标注要求                                                                 | 示例                          |
|---------------|--------------------------------------------------------------------------|-------------------------------|
| 淘宝链接      | 填写元器件的淘宝/1688采购链接（支持完整URL或店铺名+商品名）              | https://detail.tmall.com/item.htm?id=123456 |
| 下单配置      | 填写采购规格（如封装、型号补充、数量要求），无链接时必填                 | 0805封装 1kΩ ±1%              |
| 最小起订量    | 填写供应商要求的最小采购量（无链接/配置时，填此列也视为自采）            | 100个/包                      |
> 注意：若3列均为空，脚本会判定为“非自采器件”，不纳入自采汇总。

### 2. 文件命名标准（脚本自动识别的前提）
#### （1）原始BOM文件（输入文件）
- 格式：`BOM_模块名-v主版本号.次版本号(可选).xlsx/xls`  
- 示例：`BOM_电机驱动模块-v1.0.xlsx`、`BOM_传感器扩展板-v2.1.3.xls`  
- 要求：必须以`BOM_`开头，包含`-v版本号`，后缀为`.xlsx`（推荐）或`.xls`。

#### （2）ModAcc配件清单模板（输入/输出文件）
- 生成模板格式（脚本`mod_acc_list_gen.py`自动生成）：`ModAcc_模块名-V版本号.xlsx`  
- 示例：`ModAcc_MG811二氧化碳模块-V1.2.0.xlsx`  
- 要求：模块文件夹需按`模块名-V版本号`命名（如`MG811二氧化碳模块-V1.2.0`），脚本会在文件夹内生成对应模板。

#### （3）脚本输出文件（自动生成，无需手动命名）
- 自采器件输出：前缀`1_按模块汇总_`/`2_去重_`（如`1_按模块汇总_自采元器件.xlsx`）  
- 非自采器件输出：固定名`非自采器件分类汇总表.xlsx`  
- 配件清单输出：前缀`1_按模块汇总的`/`2_去重后的`（如`1_按模块汇总的配件表.xlsx`）。

### 3. 脚本放置位置（避免路径错误）
所有Python脚本必须放在**“根工作目录”** 下，根目录定义：  
→ 包含所有“模块文件夹”“原始BOM文件”的**总目录**（脚本会自动遍历根目录下的所有子文件夹，无需手动指定路径）。  
- 错误示例：将脚本放在某一个模块文件夹内（会导致其他模块的文件无法识别）。  
- 正确示例：根目录`2025_电机控制板项目`下，放所有脚本+`电机驱动模块-V1.0`文件夹+`传感器模块-V1.2`文件夹。

### 4. 推荐文件夹结构（适配小工作室流程）
建议按“项目-模块-文件”分层，确保文件有序，脚本能正常识别：
```
2025_电机控制板项目/
├─ # 根工作目录（所有脚本放这里）
├─ extract_bom_components.py          # 脚本1：BOM自采处理
├─ process_non_self_purchase_components.py      # 脚本2：BOM非自采处理
├─ mod_acc_list_gen.py                # 脚本3：ModAcc模板生成
├─ modacc_accessory_processor.py           # 脚本4：ModAcc配件处理
├─ bom_component_search.py                   # 脚本5：BOM关键词搜索
├─ 电机驱动模块 - V1.0/                    # 模块文件夹（按“模块名 - V版本号”命名）
│  ├─ BOM_电机驱动模块 - v1.0.xlsx         # 原始BOM文件（符合命名标准）
│  └─ ModAcc_电机驱动模块 - V1.0.xlsx      # 脚本3生成的配件清单模板
├─ 传感器扩展板 - V1.2/                    # 另一模块文件夹
│  ├─ BOM_传感器扩展板 - v1.2.xlsx         # 原始BOM文件
│  └─ ModAcc_传感器扩展板 - V1.2.xlsx      # 配件清单模板
└─ 输出文件/                               # 可选：手动创建，用于存放脚本生成的汇总表
   ├─ 1_按模块汇总_自采元器件.xlsx
   ├─ 非自采器件分类汇总表.xlsx
   └─ 1_按模块汇总的配件表.xlsx
```

## 三、使用步骤（按场景分类，附命令）

### 场景1：生成ModAcc配件清单模板（用于填写配件信息）
1. 按“推荐文件夹结构”，在根目录下创建模块文件夹（如`MG811二氧化碳模块-V1.2.0`）。  
2. 运行脚本：在根目录打开终端，输入命令：  
```bash
python mod_acc_list_gen.py
```
3. 脚本会自动在每个模块文件夹内生成`ModAcc_模块名-V版本号.xlsx`模板（含预设列和公式：A 列序号自增、E 列总价 = B 列数量 ×D 列单价）。

### 场景 2：处理 BOM 自采器件（生成采购清单）
1. 将原始 BOM 文件（符合命名标准）放入对应模块文件夹内。
2. 确保 BOM 文件中 “自采器件” 已按 “自采器件标注格式” 填写（淘宝链接 / 下单配置 / 最小起订量非空）。
3. 运行脚本：
```bash
python extract_bom_components.py
```
* 根目录生成 2 个文件：
  - **1_按模块汇总_自采元器件.xlsx**：按模块分组，合并相同模块单元格，便于按模块采购。
  - **2_去重_自采元器件类型.xlsx**：去重相同元器件，便于统计总需求量。

### 场景 3：处理 BOM 非自采器件（对接合作厂商）
1. 原始 BOM 文件放入模块文件夹（无需额外标注，脚本自动识别 3 列均空的器件）。
2. 运行脚本：
```bash
python process_non_self_purchase_components.py
```
3. 根目录生成 **非自采器件分类汇总表.xlsx**：区分 “常规器件”（位号 / 供应商编号齐全）和 “特殊器件”（信息缺失），方便发给厂商确认。

### 场景 4：搜索 BOM 中的指定元器件（换料 / 追溯）
1. 打开 `bom_component_search.py`，修改第 35 行的 `SEARCH_KEY` 变量（如找可调电阻，改为 `SEARCH_KEY = "RES-ADJ-TH_3362P"`）。
2. 运行脚本：
```bash
python bom_component_search.py
```
3. 终端输出结果：包含该关键词的 BOM 文件名及完整路径（如找到匹配文件：`BOM_电机驱动模块-v1.0.xlsx`（路径：`/2025_电机控制板项目/电机驱动模块-V1.0/BOM_电机驱动模块-v1.0.xlsx`））

### 场景 5：处理 ModAcc 配件清单（生成汇总表）
1. 在 ModAcc 模板中填写配件信息（确保 “自采标注” 列非空）。
2. 运行脚本：
```bash
python modacc_accessory_processor.py
```
3. 根目录生成 2 个文件：
  - **1_按模块汇总的配件表.xlsx**：按模块汇总，同模块同颜色。
  - **2_去重后的配件类型表.xlsx**：去重配件类型，便于批量采购。

## 四、使用要求（环境与依赖）

1. **Python 版本：** 需安装 Python 3.8 及以上（推荐 3.10，兼容性最好）。
- 下载地址：https://www.python.org/downloads/（安装时勾选 “Add Python to PATH”）。
2. **依赖库安装：** 脚本依赖 2 个库，首次使用需在终端执行命令安装：
   ``` bash
   pip install pandas openpyxl
   ```
  - **pandas**：用于处理 Excel 数据（筛选、汇总、去重）。
  - **openpyxl**：用于生成和美化 Excel（边框、颜色、合并单元格）。

3. **Excel 格式要求：**
   - 推荐使用 `.xlsx` 格式（`.xls` 旧格式可能导致读取错误）。
   - 原始 BOM / 配件清单的表头需与脚本预设列名一致（若不一致，修改脚本中 `core_columns` 变量，示例见 “注意事项 2”）。

## 五、注意事项（避免常见问题）
1. **脚本报错 “未找到文件”：**
   - 检查：脚本是否放在根工作目录？模块文件夹是否按 “模块名 - V 版本号” 命名？BOM 文件是否符合 BOM_模块名-v版本号.xlsx 格式？
2. **脚本报错 “缺少列”：**
   - 原因：原始 BOM 的列名与脚本预设列名不匹配（如脚本用 Manufacturer Part，你的 BOM 用 “器件型号”）。
   - 解决：打开对应脚本，找到 core_columns 变量，修改为你的 BOM 列名。示例：
  ```
  原代码：core_columns = ['Manufacturer Part', 'Quantity', ...]
  修改后：core_columns = ['器件型号', '数量', ...]（确保顺序与 BOM 一致）。
  ```

3. **生成的 Excel 无颜色 / 边框：**
   - 检查：是否安装了 `openpyxl` 库？运行脚本时是否报错 “ModuleNotFoundError: No module named 'openpyxl'”？
   - 解决：重新执行 `pip install openpyxl`，确保安装成功。

4. **小批量生产建议：**
   - 采购前：用 “去重表” 统计同一元器件的总需求量（避免多次小批量采购，节省运费）。
   - 生产后：将 “汇总表” 与原始 BOM、采购记录放在同一模块文件夹，便于后续复盘或二次生产。